
```{r paketit-g14, include=FALSE}
# Paketit 1.2.20, kommentoin pois ne joita ei ole käytetty (likert, stargazer)
library(rgl)
library(ca)
library(haven)
library(dplyr)
library(knitr)
library(tidyverse)
library(lubridate)
library(rmarkdown)
library(ggplot2)
library(furniture)
# library(likert) # ei käytetty(1.2.20)
library(scales) # G_1_2 - kuva
library(reshape2)  # G_1_2 - kuva
library(printr) #19.5.18 taulukoiden ja matriisien tulostukseen
# library(stargazer) # 28.5.2018 taulukoiden yms. tulostukseen,ei käytetty(1.2.20)

#Uusia 13.6.2018
library(bookdown)
library(tinytex)
# Uusia 1/2020
library(assertthat)
library(testthat)
#
#r-skripteillä riittää, kun ajaa tämän
sessionInfo()

```

# Yksinkertaisen korrespondenssianalyysin laajennuksia 1

Korrespondenssianalyysi sallii rivien tai sarakkeiden yhdistelyn tai
"jakamisen". Tämä onnistuu esimerkkiaineistossa lisäämällä rivejä eli jakamalla
eri maiden vastausksia useampaan ryhmään.

Sen avulla voi myös tarkastella ja vertailla erilaisia ryhmien välisiä tai
ryhmien sisäisiä (within groups - between groups) eroja hieman. Teknisesti
yksinkertaista korrespondenssianalyysiä sovelletaan muokattuun matriisiin. 
Datamatriisi rakennetaan useammasta alimatriisista, joko "pinoamalla"
osamatriiseja (stacked matrices) tai muodostamalla symmetrinen lohkomatriisi
(ABBA).

Nyt käytetään johdattelevan esimerkin dataa, johon muunnokset on jo alustavasti 
tehty.

**Vanhaa koodia kolme koodilohkoa**
```{r G1_4_CAlaaj1DataOLD, eval=FALSE, include=FALSE}

# Saksan ja Belgian aluejako - täydentävät pisteet

# EI KAI KOKO DATAA LUETA ALUSTA ALKAEN UUDESTAAN?? (2.2.20)
# ISSP2012esim1.data <- read_spss("data/ZA5900_v4-0-0.sav") # Alkuperäinen data, ( user_na = TRUE pois 25.9.2018)

#str(ISSP2012esim1.data) 
#61754 obs. of  420 variables
#
# VAHAA KOODIA
#
# KUUSI MAATA
#
# incl_esim1 <- c(56, 100, 208, 246, 276, 348) #BE,BG,DK,FI,DE,HU)

# ISSP2012esim1.dat <- filter(ISSP2012esim1.data, V4 %in% incl_esim1) 

# str(ISSP2012esim1.dat) #8557 obs. of  420 variables
#
# mukaan muuttujat, V3 jos halutaan jakaa Saksa ja Belgia
# SEX 1=male, 2=female AGE haastateltava ikä haastatteluhetkellä

# MUUTTUJAT

#ISSP2012esim1.dat <- select(ISSP2012esim1.dat, C_ALPHAN, V3,V4, V6, SEX, AGE) 

#str(ISSP2012esim1.dat) #8557 obs. of  6 variables
#
# Poistetaan havainnot, joissa puuttuvia tietoja

#ISSP2012esim1.dat <- filter(ISSP2012esim1.dat, (!is.na(V6) & !is.na(SEX) & !is.na(AGE)))

#str(ISSP2012esim1.dat) #8143 havaintoa, 6 muuttujaa
#8557-8143 = 414 havaintoa vähemmän

# sp (sukupuoli) m = 1, f = 2
#sp_labels <- c("m","f")
#
# vastausvaihtoehdot
#
# 1 = täysin samaa mieltä, 2 = samaa mieltä, 3 = ei samaa eikä eri, 4 = eri mieltä, 5 = täysin eri mieltä
# vastaus_labels <- c("S","s","?","e","E")

# Faktoreiksi - onko ihan oikein? On(26.9.18) - faktoroitu uudeksi muuttujaksi, vanhassa säilyvät metatiedot (10.10.18)

# ISSP2012esim1.dat$maa <- factor(ISSP2012esim1.dat$C_ALPHAN)
#ISSP2012esim1.dat$sp <- factor(ISSP2012esim1.dat$SEX, labels = sp_labels) #pitäisikö lisätä levels?
#ISSP2012esim1.dat$Q1b <- factor(ISSP2012esim1.dat$V6, labels = vastaus_labels) #pitäisikö lisätä levels?
#str(ISSP2012esim1.dat)
#str(ISSP2012esim1.dat$sp)
#summary(ISSP2012esim1.dat)
#ISSP2012esim1.dat %>% tableX(sp, V6, type = "row_perc")
```

```{r G1_4_CAlaaj1Data, eval=FALSE, include=FALSE}
# Uusi data, luotu G1_2_johdesim.Rmd - jaksossa - ei kuvailuja enään tähän (19.2.20)
str(ISSP2012esim1.dat)
```

```{r G1_4_maa2OLD, eval=FALSE, include=FALSE}
# HUOM! Nyt maa3 (3.2.20)

# 23.5.2018 maa2 - muuttuja / NYT maa3 (3.2.20)
# ISO 3166 Code kansallisvaltiolle muuttujassa V4 (EI, V4 on whole nation states! 3.2.20)
#
# ISO 3166 Code V3 - maiden jaot
#  5601     BE-FLA-Belgium/ Flanders
#  5602     BE-WAL-Belgium/ Wallonia
#  5603     BE-BRU-Belgium/ Brussels
# 27601     DE-W-Germany-West
# 27602     DE-E-Germany-East
# ISSP2012esim1.dat$maa2 <- factor(ISSP2012esim1.dat$V3, 
#                  levels = c("100","208","246","348","5601","5602","5603","27601","27602"),
#                  labels = c("BG","DK","FI","HU","bF","bW","bB","dW","dE"))

#head(ISSP2012esim1.dat)
#str(ISSP2012esim1.dat$maa2)
#taulu41 <- ISSP2012esim1.dat %>% tableX(maa,maa2,type = "count") # Tarkistus maa2-muuttujalle
#kable(taulu41,digits = 2, caption = "Uusi muuttuja maa2: Belgian ja Saksan ositus")

```


## Täydentävät muuttujat (supplementary points)

**zxy** Piste sinne piirretään, mutta muuttujassa on se tieto.
"Täydentävät piste"" kuulostaa huonolta. Lisämuuttujat, havainnot, lisäpisteet?

**Viite:CAip ss 89, HY2017_MCA.**

Aineistossa on havaintoja (rivejä) tai muuttujia (sarakkeita), joista voi olla
hyötyä tulosten tulkinnassa. Nämä lisäpisteet voidaan sijoittaa kartalle, jos
niitä voidaan jotenkin järkevästi vertailla kartan luomisessa käytettyihin
profiileihin (riveihin ja sarakkeisiin). 

**EDIT** Lisätään Belgian ja Saksan aluejako täydentäviksi riveiksi. Sopii
tarinaan, dimensioiden tulkinta ei ollut esimerkissä kovin kirkas. Viite CAip:n
lukuun, jossa vain todetaan että maita ei ole järkevää painottaa (massa)
otoskoolla, vaan vakioidaan (jotenkin) sama (suhteellinen) massa kaikille.
Samalla oikaistaan myös naisten yliedustus aineistossa.

**Käsitteitä:** 
(@)Active point, aktiivinen piste (aktiivinen havainto tai
muuttuja). 
(@)Supplementary pointtäydentävä piste (täydentävä havainto).

Täydentävien muuttujien kolme käyttötapaa:

1. Sisällöllisesti tutkimusongelman kannalta poikkeava tai erilainen rivi tai
sarake

2. Outlayerit, poikkeava havainto jolla pieni massa (esimerkissä uusi
sarakemuuttuja, jossa kovin vähän havaintoja)

3.  osaryhmät
**EDIT** capaper- jäsentelyssä ja bookdown-dokumentissa selitetetty 
täydentävät/lisäpisteet tarkemmin (18.9.2018).

```{r G1-4suppoints-BeDe}
# Kömpelöä koodia, harjoitellaan taulukoiden yhdistelyä (CAtest1.Rmd)
# Belgian ja Sakasan jako lisäpisteinä 24.5.2018
#head(ISSP2012esim1.dat)

# HUOM! Tässä ei vielä supp.points mukana!
suppointCA1 <- ca(~maa3 + Q1b,ISSP2012esim1.dat)
plot(suppointCA1, main = "Belgian ja Saksan ositteet",
                sub = "symmetrinen kartta")

# VANHAA 21.2.20
#
#Jos kuva kääntyy ympäri, kerrotaan koordinaattivektorit luvulla -1
#summary(suppointCA1)
#print(suppointCA1)
#str(suppointCA1)
#
# Käännetään kuva - EI TARVITA ENÄÄN, maa3-muuttujan järjestys sama kuin 
# maa- muuttujan (C_ALPHAN - järjestys)

# suppointCA1b <- suppointCA1
# suppointCA1b$rowcoord <- suppointCA1b$rowcoord[,] * (-1)
# suppointCA1b$colcoord <- suppointCA1b$colcoord[,] * (-1)
# suppointCA1b$rowcoord
# suppointCA1b$colcoord
# plot(suppointCA1b, main = "Belgian ja Saksan ositteet - käännetty kartta")

# Miten lisärivit? (24.5.2018)
# Luetaan data tauluksi - ei toimi, char-table.Toimisiko nyt, ei chr? (4.2.20)
# yritetään uudestaan table-funktiolla

# data maa3-muuttujassa
# str(ISSP2012esim1.dat$maa3)
# attributes(ISSP2012esim1.dat$maa3)

suppoint1_df1 <- select(ISSP2012esim1.dat, maa3,Q1b)
#str(suppoint1_df1)
#head(suppoint1_df1)

# str(suppoint1_tab1) - tarkistuksiin jos koodi suoritetaan rivi kerrallaan

suppoint1_tab1 <- table(suppoint1_df1$maa3, suppoint1_df1$Q1b)
suppoint1_tab1 
#plot(ca(~maa2 + V6, suppoint1_df1)) #toimii
#
# Saksan ja Belgian summarivit
#
suppoint2_df <- filter(ISSP2012esim1.dat, (maa == "BE" | maa == "DE"))
suppoint2_df <- select(suppoint2_df, maa, Q1b)
#head(suppoint2_df)
#tail(suppoint2_df)
str(suppoint2_df)
# attributes(suppoint2_df) # korvaa attr(x, which) tms. liian pitkä tulostus
# attr(suppoint2_df, which = "class")
# attr(suppoint2_df, which = "name")
# summary(suppoint2_df)
suppoint2_df %>% table1() # miksi ei tulosta mitään (4.2.20)

suppoint2_tab1 <- table(suppoint2_df$maa, suppoint2_df$Q1b)
suppoint2_tab1 # tarkistus
suppoint2_tab1 <- suppoint2_tab1[-2,]
# kömpelösti kolme kertaa
suppoint2_tab1 <- suppoint2_tab1[-3,]
suppoint2_tab1 <- suppoint2_tab1[-3,]
suppoint2_tab1 <- suppoint2_tab1[-3,]

suppoint2_tab1 # Belgian ja Saksan summat yli ositteiden

#lisätään rivit maa3-muuttujan taulukkoon

suppoint1_tab1 <- rbind(suppoint1_tab1, suppoint2_tab1)
suppoint1_tab1
suppointCA2 <- ca(suppoint1_tab1[,1:5], suprow = 10:11)
plot(suppointCA2, main = "Symmetrinen kartta: Saksan(2) Belgian(3) aluejako",
     sub = "Passiiviset pisteet DE ja BE" )
# käännetään kuva VANHAA (21.2.20)
# suppointCA2b <- suppointCA2
# suppointCA2b$rowcoord <- suppointCA2b$rowcoord[,] * (-1)
# suppointCA2b$colcoord <- suppointCA2b$colcoord[,] * (-1)

# plot(suppointCA2b,main = "Saksan ja Belgian ositteet",
#     sub = "Symmetrinen kartta, passiiviset pisteet DE ja BE" )
# ca- output
#names(suppointCA2b)
#str(suppointCA2b)
#str(suppointCA2b$rowcoord)
#suppointCA2b
#suppointCA2b$rowcoord
#apply(suppointCA2b$rowcoord, 2, sum)
#suppointCA2b$rowdist
#suppointCA2b$coldist
# summary(suppointCA2)

```
Kääntöä ei tarvita, kun maiden järjestys on sama myös muuttujassa maa3 (mukana maiden jaot)

Saksan ja Belgian summarivit ovat ositteiden painotettuja keskiarvoja (sentroideja), läntisen ja itäisen Saksan rivipisteiden välisellä janalla on koko maan summapiste DE.

Piirretään vertailun vuoksi vielä asymmettrinen kartta ("kontribuutio-kartta, kontribuutio-kaksoiskuva"). 

```{r G1-4-BeDe-asymmContrib1}
#X11()
plot(suppointCA2, map = "rowgreen",
     contrib= c("absolute", "absolute"),
     mass = c(TRUE,TRUE),
     arrows = c(FALSE, TRUE),
     main = "Saksan ja Belgian alueet - asymmetrinen kartta 1",
     sub = "kontribuutiokartta (rowgreen, absolute)")

# Sama kuva, maasummat lisäpisteinä (4.2.20)

plot(suppointCA2, map = "rowgreen",
     contrib= c("relative", "relative"),
     mass = c(TRUE,TRUE),
     arrows = c(FALSE, TRUE),
     main = "Saksan ja Belgian alueet - asymmetrinen kartta 2 ",
     sub = "kontribuutiokartta (rowgreen,relative)")

```

Kaksi konrtibuutio-karttaa (MG:n keksintö) osoittavat, että tulkinnan hankaluuksista
huolimatta symmetrinen kartta on usein selkeämpi. Molemmissa ideaalipisteet sijatsevat
kaukana (vaikka ne on skaalattu hieman lähemmäs origoa), ja maapisteiden hajontaa
on aika vaikeaa nähdä. Belgian täydentävä maapiste (BE) peittyy läntisen Saksan 
(dW) alle.

Tulostetaan numeeriset taulukot.

```{r G1-4-castats1}
# CA - numeeriset tulokset

summary(suppointCA2)

```

```{r G1-4-3dCA}
# Näkyisikö Belgian aluejako kolmannessa dimensiossa? (19.2.20)
# Toimii, mutta siistittävä, samoin koko maajakoskripti!

suppointCA3 <- ca(~maa3 + Q1b,ISSP2012esim1.dat, nd=3)
# (24.2.20)
# Tulostetaan kaksi karttaa - ensimmäinen ja toinen akseli uuden kolmannen kera

plot(suppointCA3, dim = c(1,3), 
                main = "Belgian ja Saksan ositteet - kolme dimensiota",
                sub = "symmetrinen kartta - 1. ja 3. dimensio")

plot(suppointCA3, dim = c(2,3),
                main = "Belgian ja Saksan ositteet - kolme dimensiota",
                sub = "symmetrinen kartta - 2. ja 3. dimensio")



# summary(suppointCA3) - virheilmoitus (21.2.20)

# Virheilmoitus "Error in rsc %*% diag(sv) : non-conformable arguments" ?!
# onko vika täydentävissä pisteissä? Ei ole, eivät ole mukana
# ISSP2012esim1.dat %>% tableX(maa3, Q1b)

suppointCA3

# Virheilmoituksen selvittelyä (24.2.20)
# str(suppointCA3)
# diag(suppointCA3$sv)



# plot3d(suppointCA3, c(1,2,3))

# Hyödyllinen, mutta aika vaikea

```



## Lisämuuttujat: ikäluokka ja sukupuoli

**zxy** Otsikkoa pitää harkita, CAip - kirjassa tämä on ensimmäinen esimerkki yksinkertaisen CA:n laajennuksesta. Otsikkona on "multiway tables", ja tästä yhteisvaikutusmuuttujan (interactive coding) luominen on ensimmäinen esimerkki. Menetelmää taivutetaan sen jälkeen moneen suuntaan.


Luodaan luokiteltu ikämuuttua age_cat, ja sen avulla iän ja sukupuolen interaktiomuuttuja ga. Maiden välillä on hieman eroja siinä, kuinka nuoria vastaajia on otettu tutkimuksen kohteeksi. Suomessa alaikäraja on 15 vuotta, monessa maassa se on hieman korkeampi. Ikäluokat ovat (1=15-25, 2 =26-35, 3=36-45, 4=46-55, 5=56-65, 6= 66 tai vanhempi). Vuorovaikutusmuuttuja ga koodataan f1,..., f6 ja m1,...,m6. Muuttujien nimet kannattaa pitää mahdollisimman lyhyinä.


```{r G1-4agecat}
# Iän ja sukupuolen vuorovaikutusmuuttujia 1
#
# Uusi R-data: ISSP2012esim2.dat - MIKSI, TARVITAANKO? *esim1.dat kelpaisi?(4.2.20)
#
#age_cat
#AGE 1=15-25, 2 =26-35, 3=36-45, 4=46-55, 5=56-65, 6= 66 and older
#
#summary(ISSP2012esim1.dat$AGE)
hist(ISSP2012esim1.dat$ika)

ISSP2012esim2.dat <- mutate(ISSP2012esim1.dat, age_cat = ifelse(ika %in% 15:25, "1",
                        ifelse(ika %in% 26:35, "2",
                        ifelse(ika %in% 36:45, "3",
                        ifelse(ika %in% 46:55, "4",
                        ifelse(ika %in% 56:65, "5", "6"))))))


ISSP2012esim2.dat <- ISSP2012esim2.dat %>%   # uusi (4.2.20)
        mutate(age_cat = as_factor(age_cat)) # järjestys omituinen! (4.2.20)
# Tarkistuksia 

# str(ISSP2012esim2.dat$age_cat)
# levels(ISSP2012esim2.dat$age_cat)
# ISSP2012esim2.dat$age_cat %>% summary()

# Järjestetään ikäluokat uudelleen

ISSP2012esim2.dat <- ISSP2012esim2.dat %>% 
        mutate(age_cat =
                fct_relevel(age_cat,
                            "1",
                            "2",
                            "3",
                            "4",
                            "5",
                            "6")
               )
    
# Tarkistuksia

# Iso taulukko, voi tarkistaa että muunnos ok.
# test6 %>% tableX(AGE, age_cat, type = "count")
# taulu42 <- ISSP2012esim2.dat %>% tableX(maa,age_cat,type = "count")
# kable(taulu42,digits = 2, caption = "Ikäluokka age_cat")
#

# UUdet taulukot (4.2.20) 

ISSP2012esim2.dat %>% 
    tableX(maa,age_cat,type = "count") %>%
    kable(digits = 2, caption = "Ikäluokka age_cat")

ISSP2012esim2.dat %>% 
    tableX(maa,age_cat,type = "row_perc") %>%
    kable(digits = 2, caption = "age_cat: suhteelliset frekvenssit")

```

Ikäjäkauma painottuu kaikissa maissa jonkinverran vanhempiin ikäluokkiin. Nuorempien ikäluokkien osuus on (alle 26-vuotiaan ja alle 26-35 - vuotiaat) varsinkin Bulgariassa (BG) ja Unkarissa (HU) pieni.



**zxy** Siistimmät versioit muuttujien luonnista (case_when - rakenne) (19.9.2018).


```{r G1-4ga2}
# ga - ikäluokka ja sukupuoli

# case_when: ikä ja sukupuoli
ISSP2012esim2.dat <- mutate(ISSP2012esim2.dat, ga = case_when((age_cat == "1")&(sp == "m") ~ "m1",
                                       (age_cat == "2")&(sp == "m") ~ "m2",
                                       (age_cat == "3")&(sp == "m") ~ "m3",
                                       (age_cat == "4")&(sp == "m") ~ "m4",
                                       (age_cat == "5")&(sp == "m") ~ "m5",
                                       (age_cat == "6")&(sp == "m") ~ "m6",
                                       (age_cat == "1")&(sp == "f") ~ "f1",
                                       (age_cat == "2")&(sp == "f") ~ "f2",
                                       (age_cat == "3")&(sp == "f") ~ "f3",
                                       (age_cat == "4")&(sp == "f") ~ "f4",
                                       (age_cat == "4")&(sp == "f") ~ "f4",
                                       (age_cat == "5")&(sp == "f") ~ "f5",
                                       (age_cat == "6")&(sp == "f") ~ "f6",
                                       TRUE ~ "missing"
                                  ))

#ISSP2012esim1.dat %>% tableX(ga,ga2) # tarkistus uudelle muuttujan luontikoodille
# muuttujien tarkistuksia 19.9.2018
str(ISSP2012esim2.dat$ga) # chr-muuttuja, mutta toimii (4.2.20)
str(ISSP2012esim2.dat)
#str(ISSP2012esim1.dat$ga2)
# ga on merkkijono, samoin ga2, pitäisikö muuttaa faktoriksi?
# str(ISSP2012esim1.dat)

#Tulostetaan taulukkoina ga2 - muuttuja.

ISSP2012esim2.dat %>% tableX(maa,ga,type = "count") %>%
kable(digits = 2, caption = "Ikäluokka ja sukupuoli ga")

ISSP2012esim2.dat %>% tableX(maa,ga,type = "row_perc") %>%
kable(digits = 2, caption = "ga: suhteelliset frekvenssit")


```

**edit** Vain tarkistuksiin, toisen voi poistaa (19.9.2018)!

CAiP, ch16, täällä myös maa- ja sukupuoli- uudelleenpainotus.

```{r ga1CA1}
gaTestCA1 <- ca(~ga + Q1b,ISSP2012esim2.dat)
plot(gaTestCA1, main = "Äiti töissä: ikäluokka ja sukupuoli",
     sub = "symmetrinen kartta")
summary(gaTestCA1)              
```

**zxy** Ei kovin kiinnostava, mutta voi verrata sekä edellisiin maa-vertailuihin että maan, ikäluokan ja sukupuolen yhteisvaikutusmuuttujan tuloksiin. MG tutkailee eri kysymyksellä tätä samaa asiaa, ja havaitsee että (a) maiden erot suuria ja sukupuolten pieniä (b) naiset liberaalimpia kuin miehet.

**zxy** miten pitäisi tulkita "oikealle kaatunut U - muoto" miehillä ja naisilla? Järjestys ei toimi, jotain muuta pelissä?


**zxy** On kiinnostava, mutta aika yksiuloitteinen (87 prosenttia ensimmäisellä dimensiolla!). **pisteet voisi yhdistää? (29.9.18)** 



```{r maaga1}
# Luodaan aineistoon kolmen muuttujan yhdysvaikutusmuuttuja maaga, maa, ikäluokka ja sukupuoli.
# Yleensä ei yhdysvaikuksissa mennä yli kolmen luokittelumuuttujan, ja tässäkin vain maiden pieni lukumää
# tekee tarkastelun aika helpoksi.

ISSP2012esim2.dat <- mutate(ISSP2012esim2.dat, maaga = paste(maa, ga, sep = ""))

ISSP2012esim2.dat %>% tableX(maa, maaga) # tarkistus, muunnos ok

#head(ISSP2012esim2.dat)
str(ISSP2012esim2.dat)

```

**TARKISTA - ja maat voisi lisätä täydentävinä pisteinä (26.9.2018)** 

```{r maagaCA1}

maagaTestCA1 <- ca(~maaga + Q1b,ISSP2012esim2.dat)
# par("cex"= 0.5, "offset" = 0.5) #ei toimi ja plot-komennossa offset tuottaa
# saman varoituksen: "offset is not a graphical parameter"

# (24.2.20) Hyvin outoa! Tämä par-komento toimii seuraavassa koodilohkossa,
# tässä tulee virheilmoitus 
# "asp" is not a graphical parameter"offset" is not a graphical parameter
# par("cex"= 0.75, "asp" = 1, "offset" = 0.5)

plot(maagaTestCA1, main = "Äiti töissä: ikäluokka ja sukupuoli maittain",
                sub = "symmetrinen kartta")

# str(maagaTestCA1)

ISSP2012esim2.dat %>% tableX(maaga, Q1b) # aika pieniä frekvenssejä soluissa!
maagasummary(maagaTestCA1) 

# (24.2.20) Miten voisi kätevästi tarkistaa, että mikään pienen massa piste ei 
# vaikuta (kontribuutiot) liikaa karttaan?

str(maagaTestCA1)

```
```{r maagaCA2}
# Miten maa-rivit täydentäviksi riveiksi - alla siisti ratkaisu
# Miten labelit hieman lähemmäkis pistettä? offset-jotenkin toimii...

# rakennetaan taulukko, jossa alimpina riveinä "maa-rivit"
# otetaan karttaan mukaan täydentävinä pisteinä
# karttaa on helpompi tulkita, kun nähdään miten ikä-sukupuoli-ryhmät sijatsevat keskiarvonsa ympärillä

#ikäluokka - sukupuoli ja maa - maaga-muuttuja
testTab1 <- table(ISSP2012esim2.dat$maaga, ISSP2012esim2.dat$Q1b)
#dim(testTab1) #72 riviä,  5 saraketta


# maa-rivit
testTab_sr <- table(ISSP2012esim2.dat$maa, ISSP2012esim2.dat$Q1b)
#testTab_sr

testTab1 <- rbind(testTab1,testTab_sr)
#dim(testTab1)
#dim(testTab1) #78 riviä, 5 saraketta, 1-72 data ja 73-78 täydentävät rivit

spCAmaaga1 <- ca(testTab1[,1:5], suprow = 73:78)
#X11()

# Plot toimii (4.2.20), mutta par() ei, sama virheilmoitus (varoitus) 
# kuin edellisessä koodilohkossa (24.2.20)
# par("cex"= 0.75, "asp" = 1, "offset" = 0.5)
plot(spCAmaaga1, main = "Äiti töissä: ikäluokka ja sukupuoli maittain 2",
                sub = "symmetrinen kartta, maat täydentävinä pisteinä"
                    )
#par()

#asymmetrinen kartta
#X11()
#par("cex"= 0.75, "asp" = 1, "offset" = 0.5)
#plot(spCAmaaga1, main = "Äiti töissä: ikäluokka ja sukupuoli maittain 3 (kontribuutiot) - liian tukkoinen kuva",
#                  map = "rowgreen", 
#                  contrib= c("absolute", "absolute"),
#                  mass = c(TRUE,TRUE),
#                  arrows = c(FALSE,TRUE)
#                  )

```


Kuvissa on aika ahdasta. Kuvan voisi rajata johonkin alueeseen erityisesti oikea yläosa on täynnä pisteitä. Maiden täydentävät pisteet ovat ikäluokka-sukupuoli - luokkien keskiarvopisteitä. Maiden väliset erot dominoivat, mutta maiden välillä on isoja eroja.

Kartan herkkyyttä joillekin pienen massan rivipisteille pitää tutkia tarkemmin.

Vertailu voi tehdä

1.Maiden sisällä, ikä-sukupuoli - luokkien välillä. Ovatko naiset kaikissa ikäluokissa mies-ikäluokkien oikealla vai vasemmalla puolella?

2.Maiden välillä

a. miten ikä-sukupuoliluokat sijaitsevat suhteessa maiden keskiarvopisteisiin

b. mikä on niiden järjestys

